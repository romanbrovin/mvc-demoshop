function actionItem(t){let e=new Object;e.token2=token2,$.each($("#form").serializeArray(),function(t,o){e[o.name]=o.value}),$("input:checkbox:checked").each(function(){e[$(this).attr("name")]=1}),$("textarea").each(function(){e[this.name]="",$(this).length&&(e[this.name]=tinymce.get(this.name).getContent())});let o=$(".btn__"+t);o.prop("disabled",!0),loader(),$.ajax({type:"POST",url:"/adm/"+uri+"/"+t,data:e}).done(function(a){let n=JSON.parse(a);if($(".is-invalid").removeClass("is-invalid"),"ok"==n)$(".toast").removeClass("text-bg-danger"),$(".toast").addClass("text-bg-success"),"create"==t?(txt="Запись создана",redirectUrl="/adm/"+uri):"save"==t&&(txt="Запись изменена",redirectUrl=getCookie("referrer")+"#"+e.id),$(".toast-body").html('<i class="fa-solid fa-check"></i>&nbsp;&nbsp;'+txt),toast.show(),setTimeout(function(){location.href=redirectUrl},toastTimeout);else if("non-unique-email"==n)$("#email").addClass("is-invalid"),$(".toast").addClass("text-bg-danger"),$(".toast-body").html("Введите другую электронную почту (эта уже занята)"),toast.show(),o.prop("disabled",!1),loader(0);else if("non-unique-name"==n)$("#name").addClass("is-invalid"),$(".toast").addClass("text-bg-danger"),$(".toast-body").html("Введите другое название (это уже занято)"),toast.show(),o.prop("disabled",!1),loader(0);else if("non-unique-article"==n)$("#article").addClass("is-invalid"),$(".toast").addClass("text-bg-danger"),$(".toast-body").html("Введите другой артикул (этот уже занят)"),toast.show(),o.prop("disabled",!1),loader(0);else{if(n.length>0){let t="";for(let e in n)t+="<br>&mdash;&nbsp;&nbsp;"+$("#"+n[e]+"~ .feedback-short").html(),$("#"+n[e]).addClass("is-invalid");t='<strong><i class="fa-solid fa-triangle-exclamation"></i>&nbsp;&nbsp;Необходимо ввести:</strong>'+t,$(".toast").addClass("text-bg-danger"),$(".toast-body").html(t),toast.show()}o.prop("disabled",!1),loader(0)}})}function deleteItem(t){let e=new Object;e.token2=token2,e.id=t,loader(),$.ajax({type:"POST",url:"/adm/"+uri+"/delete",data:e}).done(function(){$(".notification").hide(),$(".toast").addClass("text-bg-secondary"),$(".toast-body").html('<i class="fa-solid fa-check"></i>&nbsp;&nbsp;Запись удалена'),toast.show(),setTimeout(function(){location.reload()},toastTimeout)})}function getComment(t){let e=new Object;e.token2=token2,e.id=t,$.ajax({type:"POST",url:"/adm/"+uri+"/get-data",data:e}).done(function(e){let o=JSON.parse(e);str='<div class="modal-header border-bottom-0">    <h4 class="modal-title">Заметка</h4>    <button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button></div><div class="modal-body py-0">   <div class="form-floating">       <input class="form-control" id="comment" maxlength="90" placeholder="Текст"            type="text" value="'+o.comment_admin+'">       <label for="comment">Текст</label>   </div></div><div class="modal-footer border-top-0 mt-2">    <div class="modal-footer-id">ID '+o.id+'</div>    <button onclick="setComment('+t+')" class="btn btn-primary btn-sm" type="button">       Сохранить    </button></div>',$(".notification .modal-content").html(str),new bootstrap.Modal(".notification",{}).show(),$("#comment").on("input",function(t){let e=$(this).attr("placeholder"),o=$(this).attr("maxlength"),a=$(this).val().length;o&&a>0&&(e=e+" "+a+"/"+o),$(this).next("label").html(e)}),$("#comment").keydown(function(e){13===e.keyCode&&setComment(t)})})}function setComment(t){let e=new Object;e.token2=token2,e.id=t,e.comment=$("#comment").val(),loader(),$.ajax({type:"POST",url:"/adm/"+uri+"/set-comment",data:e}).done(function(){$(".notification").hide(),$(".toast").addClass("text-bg-success"),$(".toast-body").html('<i class="fa-solid fa-check"></i>&nbsp;&nbsp;Заметка изменена'),toast.show(),setTimeout(function(){location.reload()},toastTimeout)})}function getSortOrder(t){let e=new Object;e.token2=token2,e.id=t,$.ajax({type:"POST",url:"/adm/"+uri+"/get-data",data:e}).done(function(e){let o=JSON.parse(e);str='<div class="modal-header border-bottom-0">    <h4 class="modal-title">Порядок сортировки</h4>    <button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button></div><div class="modal-body py-0">   <div class="form-floating">       <input class="form-control" id="sort" type="number" min="0" max="99"            value="'+o.sort_order+'">       <label for="sort_order">Число / от 0 до 99</label>   </div>   <div class="mt-3 text-secondary">       Чем больше это значение, тем выше эта позиция в общем списке   </div></div><div class="modal-footer border-top-0 mt-2">    <div class="modal-footer-id">ID '+o.id+'</div>    <button onclick="setSortOrder('+t+')" class="btn btn-primary btn-sm" type="button">       Сохранить    </button></div>',$(".notification .modal-content").html(str),new bootstrap.Modal(".notification",{}).show(),$("#sort").keydown(function(e){13===e.keyCode&&setSortOrder(t)})})}function setSortOrder(t){let e=new Object;e.token2=token2,e.id=t,e.sort=$("#sort").val(),loader(),$.ajax({type:"POST",url:"/adm/"+uri+"/set-sort-order",data:e}).done(function(){$(".notification").hide(),$(".toast").addClass("text-bg-success"),$(".toast-body").html('<i class="fa-solid fa-check"></i>&nbsp;&nbsp;Порядок сортировки изменен'),toast.show(),setTimeout(function(){location.reload()},toastTimeout)})}function uploadPhotoToItem(t){let e=new FormData,o=0;$.each($("#files_"+t)[0].files,function(t,a){e.append(t,a),o++}),e.append("token2",token2),e.append("id",t),loader(),$.ajax({type:"POST",url:"/adm/"+uri+"/upload-photo",data:e,cache:!1,contentType:!1,processData:!1}).done(function(){str=1==o?"Фотография загружена":"Фотографии загружены",$(".notification").hide(),$(".toast").addClass("text-bg-success"),$(".toast-body").html('<i class="fa-solid fa-check"></i>&nbsp;&nbsp;'+str),toast.show(),setTimeout(function(){location.reload()},toastTimeout)})}function deletePhotoFromItem(t){let e=new Object;e.token2=token2,e.id=t,loader(),$.ajax({type:"POST",url:"/adm/"+uri+"/delete-photo",data:e}).done(function(){$(".notification").hide(),$(".toast").addClass("text-bg-secondary"),$(".toast-body").html('<i class="fa-solid fa-check"></i>&nbsp;&nbsp;Фотография удалена'),toast.show(),setTimeout(function(){location.reload()},toastTimeout)})}function setSplit(t){let e=new Object;e.token2=token2,e.id=t,e.amount=$("#amount").val(),loader(),$.ajax({type:"POST",url:"/adm/"+uri+"/set-split",data:e}).done(function(t){let e=JSON.parse(t);$(".is-invalid").removeClass("is-invalid"),"ok"==e?($(".toast").removeClass("text-bg-danger"),$(".toast").addClass("text-bg-success"),$(".toast-body").html('<i class="fa-solid fa-check"></i>&nbsp;&nbsp;Товар разделен'),toast.show(),setTimeout(function(){location.reload()},toastTimeout)):($("#amount").addClass("is-invalid"),loader(0))})}function setAction(t,e){let o=new Object;o.token2=token2,o.id=e,loader(),$.ajax({type:"POST",url:"/adm/"+uri+"/set-"+t,data:o}).done(function(){setTimeout(function(){location.reload()},toastTimeout)})}$(function(){uri=$("#uri").val(),$("#form").submit(function(){event.preventDefault()}),$(".btn__save").click(function(){actionItem("save")}),$(".btn__create").click(function(){actionItem("create")}),$(".btn__mark").click(function(){event.preventDefault();setAction("mark",$(this).closest(".item").attr("id"))}),$(".btn__soon").click(function(){event.preventDefault();setAction("soon",$(this).closest(".item").attr("id"))}),$(".btn__password-generate").click(function(){event.preventDefault(),number=getRandomInt(1e5,999999),$("#password").val(number)}),$(".btn__hidden").click(function(){event.preventDefault();setAction("hidden",$(this).closest(".item").attr("id"))}),$(".btn__delete").click(function(){event.preventDefault();let t=$(this).closest(".item").attr("id");str='<div class="modal-header border-bottom-0">    <h4 class="modal-title">Удалить?</h4>    <button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button></div><div class="modal-footer border-top-0">    <div class="modal-footer-id">ID '+t+'</div>    <button onclick="deleteItem('+t+')" class="btn btn-danger btn-sm" type="button">       Да, удалить    </button></div>',$(".notification .modal-content").html(str),new bootstrap.Modal(".notification",{}).show()}),$(".btn__comment").click(function(){event.preventDefault();getComment($(this).closest(".item").attr("id"))}),$(".btn__sort").click(function(){event.preventDefault();getSortOrder($(this).closest(".item").attr("id"))}),$(".btn__upload-photo").change(function(){event.preventDefault();uploadPhotoToItem($(this).closest(".item").attr("id"))}),$(".btn__delete-photo").click(function(){event.preventDefault();deletePhotoFromItem($(this).closest(".item").attr("id"))}),$(".btn__split").click(function(){event.preventDefault();let t=$(this).closest(".item").attr("id");str='<div class="modal-header border-bottom-0">    <h4 class="modal-title">Разделить</h4>    <button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button></div><div class="modal-body py-0">   <div class="form-floating">       <input class="form-control" id="amount" type="number" min="0" value="1">       <label for="amount">Кол-во отделяемого товара</label>       <div class="invalid-feedback">Введите кол-во товара меньше текущего</div>   </div>   <div class="mt-3 text-secondary">       Разделение этой позиции на несколько других с сохранением основных характеристик   </div></div><div class="modal-footer border-top-0 mt-2">    <button onclick="setSplit('+t+')" class="btn btn-primary btn-sm" type="button">       Сохранить    </button></div>',$(".notification .modal-content").html(str),new bootstrap.Modal(".notification",{}).show(),$("#amount").keydown(function(e){13===e.keyCode&&setSplit(t)})}),tinymce.init({selector:"textarea",menubar:!1,plugins:"anchor autolink charmap code emoticons link lists visualblocks wordcount",toolbar:"undo redo | styleselect | bold italic | alignleft aligncenter alignright | bullist numlist | link code | forecolor backcolor removeformat"}),tinymce.init({selector:"textarea#name",height:500,auto_focus:"name"}),tinymce.init({selector:"textarea#preview",height:250}),tinymce.init({selector:"textarea#description",height:500})});