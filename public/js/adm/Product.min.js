function calcPriceWithDiscount(t){$("#price_"+t).val();let e=$("#price_"+t+"_discount").val(),o="#price_"+t+"_discount_sum",i="#price_"+t+"_discount_percent";$("#price_"+t).removeClass("is-invalid"),e>0&&$("#price_"+t).val(e),0===e.length&&($(o).html("0"),$(i).html("0"),$("#price_"+t).val(""))}function calcPrice(t){let e=$("#price_"+t).val(),o=$("#price_"+t+"_discount").val(),i="#price_"+t+"_discount_sum",a="#price_"+t+"_discount_percent";if(o>0&&e>0){let n=e-o;if($("#price_"+t).removeClass("is-invalid"),n>0){let t=n/e*100;numberAnimation(i,n),numberAnimation(a,t)}n<0&&$("#price_"+t).addClass("is-invalid")}(0===o.length||0===e.length||e>o)&&($(i).html("0"),$(a).html("0"))}function deletePhotoFromProduct(t,e){let o=new Object;o.token2=token2,o.id=t,o.photo=e,$.ajax({type:"POST",url:"/adm/product/delete-photo",data:o}).done(function(){$("[data-photo="+e+"]").fadeOut()})}function setAvatarToProduct(t,e){let o=new Object;o.token2=token2,o.id=t,o.photo=e,loader(),$.ajax({type:"POST",url:"/adm/product/set-avatar",data:o}).done(function(){$(".notification").hide(),$(".toast").addClass("text-bg-secondary"),$(".toast-body").html('<i class="fa-solid fa-check"></i>&nbsp;&nbsp;Аватарка установлена'),toast.show();let t=getCookie("referrer");setTimeout(function(){location.href=t+"#"+o.id},toastTimeout)})}function setPrices(){let t=new Object;t.token2=token2;let e=[];if($.each($("#form").serializeArray(),function(o,i){i.value<0&&e.push(i.name),t[i.name]=i.value}),e.length>0)return $.each(e,function(t,e){$("#"+e).addClass("is-invalid")}),$(".toast").addClass("text-bg-danger"),$(".toast-body").html('<i class="fa-solid fa-triangle-exclamation"></i>&nbsp;&nbsp;Неправильный формат цены'),toast.show(),!1;$(".btn__set_prices").prop("disabled",!0),loader(),$.ajax({type:"POST",url:"/adm/product/set-prices",data:t}).done(function(e){"ok"==JSON.parse(e)&&($(".toast").removeClass("text-bg-danger"),$(".toast").addClass("text-bg-success"),$(".toast-body").html('<i class="fa-solid fa-check"></i>&nbsp;&nbsp;Цены установлены'),toast.show(),redirectUrl=getCookie("referrer")+"#"+t.id,setTimeout(function(){location.href=redirectUrl},toastTimeout))})}$(function(){$.each(["adv","dbs","ozon","wb","avito"],function(t,e){$("#price_"+e+"_discount").on("input",function(t){calcPriceWithDiscount(e)}),$("#price_"+e).on("input",function(t){calcPrice(e)})}),$(".btn__set_avatar").click(function(){event.preventDefault();setAvatarToProduct($(this).closest(".item").attr("id"),$(this).closest(".item__photo").data("photo"))}),$(".btn__set_prices").click(function(){event.preventDefault(),setPrices()}),$(".btn__photo_delete").click(function(){event.preventDefault();deletePhotoFromProduct($(this).closest(".item").attr("id"),$(this).closest(".item__photo").data("photo"))})});