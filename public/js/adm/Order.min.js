function saved(t){let e=new Object;e.token2=token2,e.id=t,$.each($("#form").serializeArray(),function(t,o){e[o.name]=o.value});let o=$("#order__save");o.prop("disabled",!0),loader(),$.ajax({type:"POST",url:"/adm/order/saved",data:e}).done(function(e){let a=JSON.parse(e);if($(".is-invalid").removeClass("is-invalid"),"ok"==a)$(".toast").removeClass("text-bg-danger"),$(".toast").addClass("text-bg-success"),$(".toast-body").html('<i class="fa-solid fa-check"></i>&nbsp;&nbsp;Заказ изменен'),toast.show(),setTimeout(function(){location.href="/adm/order#"+t},toastTimeout);else{if(a.length>0){let t="";for(let e in a){let o=a[e].match(/[A-Z]+[^A-Z]*|[^A-Z]+/g);a[e]=o[1].toLowerCase(),t+="<br>&mdash;&nbsp;&nbsp;"+$("#delivery__"+a[e]+"~ .feedback-short").html(),$("#delivery__"+a[e]).addClass("is-invalid")}t='<strong><i class="fa-solid fa-triangle-exclamation"></i>&nbsp;&nbsp;Необходимо ввести:</strong>'+t,$(".toast").addClass("text-bg-danger"),$(".toast-body").html(t),toast.show()}o.prop("disabled",!1),loader(0)}})}function confirmed(t){let e=new Object;e.token2=token2,e.id=t,loader(),$.ajax({type:"POST",url:"/adm/order/confirmed",data:e}).done(function(){$(".notification").hide(),$(".toast").addClass("text-bg-success"),$(".toast-body").html('<i class="fa-solid fa-check"></i>&nbsp;&nbsp;Заказ подтвержден'),toast.show(),setTimeout(function(){location.reload()},toastTimeout)})}function delivered(t){let e=new Object;e.token2=token2,e.id=t,loader(),$.ajax({type:"POST",url:"/adm/order/delivered",data:e}).done(function(){$(".notification").hide(),$(".toast").addClass("text-bg-success"),$(".toast-body").html('<i class="fa-solid fa-check"></i>&nbsp;&nbsp;Заказ доставлен'),toast.show(),setTimeout(function(){location.reload()},toastTimeout)})}function canceled(t){let e=new Object;e.token2=token2,e.id=t,loader(),$.ajax({type:"POST",url:"/adm/order/canceled",data:e}).done(function(){$(".notification").hide(),$(".toast").addClass("text-bg-secondary"),$(".toast-body").html('<i class="fa-solid fa-check"></i>&nbsp;&nbsp;Заказ отменен'),toast.show(),setTimeout(function(){location.reload()},toastTimeout)})}function returned(t){let e=new Object;e.token2=token2,e.id=t,loader(),$.ajax({type:"POST",url:"/adm/order/returned",data:e}).done(function(){$(".notification").hide(),$(".toast").addClass("text-bg-success"),$(".toast-body").html('<i class="fa-solid fa-check"></i>&nbsp;&nbsp;Оформлен возврат товара'),toast.show(),setTimeout(function(){location.reload()},toastTimeout)})}function transited(t){let e=new Object;e.token2=token2,e.id=t,loader(),$.ajax({type:"POST",url:"/adm/order/transited",data:e}).done(function(){$(".notification").hide(),$(".toast").addClass("text-bg-success"),$(".toast-body").html('<i class="fa-solid fa-check"></i>&nbsp;&nbsp;Заказ отправлен'),toast.show(),setTimeout(function(){location.reload()},toastTimeout)})}function getDeliveryTrack(t){let e=new Object;e.token2=token2,e.id=t,$.ajax({type:"POST",url:"/adm/order/get-data",data:e}).done(function(e){let o=JSON.parse(e);str='<div class="modal-header border-bottom-0">    <h4 class="modal-title">Транспортная компания</h4>    <button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button></div><div class="modal-body py-0">   <div class="form-floating">       <input class="form-control" id="delivery_track" type="text" value="'+o.delivery_track+'">       <label for="delivery_track">Трек-номер</label>   </div></div><div class="modal-footer border-top-0 mt-2">    <div class="modal-footer-id">Заказ '+t+'</div>    <button onclick="setDeliveryTrack('+t+')" class="btn btn-primary btn-sm" type="button">Сохранить</button></div>',$(".notification .modal-content").html(str),new bootstrap.Modal(".notification",{}).show(),$("#delivery_track").keydown(function(e){13===e.keyCode&&setDeliveryTrack(t)})})}function setDeliveryTrack(t){let e=new Object;e.token2=token2,e.id=t,e.delivery_track=$("#delivery_track").val(),e.delivery_service=$('input[name="delivery-service_'+t+'"]:checked').val(),loader(),$.ajax({type:"POST",url:"/adm/order/set-delivery-track",data:e}).done(function(){$(".notification").hide(),$(".toast").addClass("text-bg-success"),$(".toast-body").html('<i class="fa-solid fa-check"></i>&nbsp;&nbsp;Трек-номер изменен'),toast.show(),setTimeout(function(){location.reload()},toastTimeout)})}function getMarketplaceOrder(t){let e=new Object;e.token2=token2,e.id=t,$.ajax({type:"POST",url:"/adm/order/get-data",data:e}).done(function(e){let o=JSON.parse(e);str='<div class="modal-header border-bottom-0">    <h4 class="modal-title">Маркетплейс</h4>    <button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button></div><div class="modal-body py-0">   <div class="form-floating">       <input class="form-control" id="marketplace_order" type="text" value="'+o.marketplace_order+'">       <label for="marketplace_order">Номер заказа</label>   </div></div><div class="modal-footer border-top-0 mt-2">    <div class="modal-footer-id">Заказ '+t+'</div>    <button onclick="setMarketplaceOrder('+t+')" class="btn btn-primary btn-sm" type="button">Сохранить</button></div>',$(".notification .modal-content").html(str),new bootstrap.Modal(".notification",{}).show(),$("#marketplace_order").keydown(function(e){13===e.keyCode&&setMarketplaceOrder(t)})})}function setMarketplaceOrder(t){let e=new Object;e.token2=token2,e.id=t,e.marketplace_order=$("#marketplace_order").val(),loader(),$.ajax({type:"POST",url:"/adm/order/set-marketplace-order",data:e}).done(function(){$(".notification").hide(),$(".toast").addClass("text-bg-success"),$(".toast-body").html('<i class="fa-solid fa-check"></i>&nbsp;&nbsp;Номер заказа на маркетплейсе изменен'),toast.show(),setTimeout(function(){location.reload()},toastTimeout)})}function setDeliveryService(t,e){let o=new Object;o.token2=token2,o.id=t,o.delivery_service=e,loader(),$.ajax({type:"POST",url:"/adm/order/set-delivery-service",data:o}).done(function(){$(".toast").addClass("text-bg-success"),$(".toast-body").html('<i class="fa-solid fa-check"></i>&nbsp;&nbsp;Транспортная компания изменена'),toast.show(),setTimeout(function(){location.reload()},toastTimeout)})}$(function(){$("#order__save").click(function(){saved(getCookie("itemId"))}),$(".order__pay").click(function(){let t=$(this).closest(".item").attr("id");getPayLink(t)}),$(".order__edit").click(function(){event.preventDefault();let t=$(this).closest(".item").attr("id");setCookie("itemId",t,{path:"/"}),location.href="/adm/order/edit"}),$(".order__confirm").click(function(){event.preventDefault();let t=$(this).closest(".item").attr("id");str='<div class="modal-header border-bottom-0">    <h4 class="modal-title">Подтвердить заказ?</h4>    <button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button></div><div class="modal-body py-0">    <div class="text-secondary">После подтверждения заказа товар будет списан со склада</div></div><div class="modal-footer border-top-0">    <div class="modal-footer-id">Заказ '+t+'</div>    <button onclick="confirmed('+t+')" class="btn btn-primary btn-sm" type="button">       Подтвердить заказ    </button></div>',$(".notification .modal-content").html(str),new bootstrap.Modal(".notification",{}).show()}),$(".order__transited").click(function(){event.preventDefault();let t=$(this).closest(".item").attr("id");str='<div class="modal-header border-bottom-0">    <h4 class="modal-title">Отправить заказ?</h4>    <button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button></div><div class="modal-body text-secondary py-0">    <div>       Статус заказа изменится на <span class="badge bg-orange">В пути</span>    </div>    <div>       Клиент получит уведомление на электронную почту    </div></div><div class="modal-footer border-top-0">    <div class="modal-footer-id">Заказ '+t+'</div>    <button onclick="transited('+t+')" class="btn btn-primary btn-sm" type="button">       Отправить заказ    </button></div>',$(".notification .modal-content").html(str),new bootstrap.Modal(".notification",{}).show()}),$(".order__delivered").click(function(){event.preventDefault();let t=$(this).closest(".item").attr("id");str='<div class="modal-header border-bottom-0">    <h4 class="modal-title">Заказ доставлен?</h4>    <button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button></div><div class="modal-body py-0">    <div class="text-secondary">       Запись о финансовых операциях по этому заказу будет добавлена в раздел        <a href="/adm/report">Отчет</a>    </div></div><div class="modal-footer border-top-0">    <div class="modal-footer-id">Заказ '+t+'</div>    <button onclick="delivered('+t+')" class="btn btn-success btn-sm" type="button">       Заказ доставлен    </button></div>',$(".notification .modal-content").html(str),new bootstrap.Modal(".notification",{}).show()}),$(".order__cancel").click(function(){event.preventDefault();let t=$(this).closest(".item").attr("id");str='<div class="modal-header border-bottom-0">    <h4 class="modal-title">Отменить заказ?</h4>    <button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button></div><div class="modal-body py-0">    <div class="text-secondary">       Если текущий статус заказа <span class="badge bg-purple">Подтвержден</span> или        <span class="badge bg-orange">В пути</span>       то заказ будет отменен, а товар в заказе будет добавлен обратно на склад    </div></div><div class="modal-footer border-top-0">    <div class="modal-footer-id">Заказ '+t+'</div>    <button onclick="canceled('+t+')" class="btn btn-danger btn-sm" type="button">       Отменить заказ    </button></div>',$(".notification .modal-content").html(str),new bootstrap.Modal(".notification",{}).show()}),$(".order__return").click(function(){event.preventDefault();let t=$(this).closest(".item").attr("id");str='<div class="modal-header border-bottom-0">    <h4 class="modal-title">Оформить возврат?</h4>    <button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button></div><div class="modal-body py-0">    <div class="text-secondary">       После оформления возврата весь товар в заказе будет добавлен обратно на склад    </div></div><div class="modal-footer border-top-0">    <div class="modal-footer-id">Заказ '+t+'</div>    <button onclick="returned('+t+')" class="btn btn-danger btn-sm" type="button">       Оформить возврат    </button></div>',$(".notification .modal-content").html(str),new bootstrap.Modal(".notification",{}).show()}),$(".order__status").hover(function(){let t=$(this).closest(".item").attr("id");$(".status_"+t).fadeIn(200)},function(){let t=$(this).closest(".item").attr("id");$(".status_"+t).fadeOut(200)}),$(".delivery-service").click(function(){setDeliveryService($(this).closest(".item").attr("id"),$(this).val())}),$(".delivery-track").click(function(){event.preventDefault();getDeliveryTrack($(this).closest(".item").attr("id"))}),$(".marketplace-order").click(function(){event.preventDefault();getMarketplaceOrder($(this).closest(".item").attr("id"))})});